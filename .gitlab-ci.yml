image: mcr.microsoft.com/dotnet/sdk:7.0

stages:          # List of stages for jobs, and their order of execution
  - build

build-debug:       # This job runs in the build stage, which runs first.
  stage: build
  retry: 2
  script:
    - apt update && apt upgrade -y
    - apt install -y python3 libfreetype6
    - mkdir .git/hooks -p
    - python3 RUN_THIS.py
    - dotnet restore
    - dotnet build --configuration Debug --no-restore /p:WarningsAsErrors=nullable /m
    - pwsh -Command "dotnet test --no-build Content.Tests/Content.Tests.csproj -- NUnit.ConsoleOut=0"
    - export DOTNET_gcServer=1
    - pwsh -Command "dotnet test --no-build Content.IntegrationTests/Content.IntegrationTests.csproj -- NUnit.ConsoleOut=0"

build-release:
  stage: build
  retry: 2
  script:
    - apt update && apt upgrade -y
    - apt install -y python3 libfreetype6
    - mkdir .git/hooks -p
    - python3 RUN_THIS.py
    - dotnet restore
    - dotnet build --configuration Release --no-restore /p:WarningsAsErrors=nullable /m
    - pwsh -Command "dotnet test --no-build Content.Tests/Content.Tests.csproj -- NUnit.ConsoleOut=0"
    - export DOTNET_gcServer=1
    - pwsh -Command "dotnet test --no-build Content.IntegrationTests/Content.IntegrationTests.csproj -- NUnit.ConsoleOut=0"
